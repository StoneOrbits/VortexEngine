\hypertarget{classTime}{}\doxysection{Time Class Reference}
\label{classTime}\index{Time@{Time}}


{\ttfamily \#include $<$Time\+Control.\+h$>$}

\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static bool \mbox{\hyperlink{classTime_a0058db559daacf8050e8a0b1d4b9fd8c}{init}} ()
\item 
static void \mbox{\hyperlink{classTime_af813bd1f7e4c08f6d84f8831738fed32}{cleanup}} ()
\item 
static void \mbox{\hyperlink{classTime_a823b10e685d34b667e16e36fea96e150}{tick\+Clock}} ()
\item 
static uint32\+\_\+t \mbox{\hyperlink{classTime_a7c7a8e067bdbd5aaf119521539d30940}{get\+Curtime}} ()
\item 
static uint32\+\_\+t \mbox{\hyperlink{classTime_a719c88f4e11a83f7167f45a2a58f5d60}{get\+Real\+Curtime}} ()
\item 
static void \mbox{\hyperlink{classTime_aaf106aff340ea506f16a010b12f51769}{set\+Tickrate}} (uint32\+\_\+t tickrate=0)
\item 
static uint32\+\_\+t \mbox{\hyperlink{classTime_acb7cd2d49094647c3fb7112e15ad16d7}{get\+Tickrate}} ()
\item 
static uint32\+\_\+t \mbox{\hyperlink{classTime_ac44f4e49538456714372bb1aad3dd839}{microseconds}} ()
\item 
static void \mbox{\hyperlink{classTime_a9682da1974a20a9bcdbb678984cd0e9c}{delay\+Microseconds}} (uint32\+\_\+t us)
\item 
static void \mbox{\hyperlink{classTime_aa90c5d6860ae306048c96d80da2ea1b0}{delay\+Milliseconds}} (uint32\+\_\+t ms)
\end{DoxyCompactItemize}
\doxysubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classTime_a4245e409c7347d1d671858962c2ca3b5}{Time}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Static Private Member Functions}
\begin{DoxyCompactItemize}
\item 
static void \mbox{\hyperlink{classTime_a4006a9aa5cc0cf1276af05aade63bccc}{init\+MCUTime}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Static Private Attributes}
\begin{DoxyCompactItemize}
\item 
static uint32\+\_\+t \mbox{\hyperlink{classTime_ac3f1dc3ad6b2ba8787643e73b17a4f1c}{m\+\_\+cur\+Tick}} = 0
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 23 of file Time\+Control.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classTime_a4245e409c7347d1d671858962c2ca3b5}\label{classTime_a4245e409c7347d1d671858962c2ca3b5}} 
\index{Time@{Time}!Time@{Time}}
\index{Time@{Time}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{Time()}{Time()}}
{\footnotesize\ttfamily Time\+::\+Time (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classTime_af813bd1f7e4c08f6d84f8831738fed32}\label{classTime_af813bd1f7e4c08f6d84f8831738fed32}} 
\index{Time@{Time}!cleanup@{cleanup}}
\index{cleanup@{cleanup}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{cleanup()}{cleanup()}}
{\footnotesize\ttfamily void Time\+::cleanup (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 75 of file Time\+Control.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{76 \{}
\DoxyCodeLine{77 \}}

\end{DoxyCode}


Referenced by Vortex\+Engine\+::cleanup().

\mbox{\Hypertarget{classTime_a9682da1974a20a9bcdbb678984cd0e9c}\label{classTime_a9682da1974a20a9bcdbb678984cd0e9c}} 
\index{Time@{Time}!delayMicroseconds@{delayMicroseconds}}
\index{delayMicroseconds@{delayMicroseconds}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{delayMicroseconds()}{delayMicroseconds()}}
{\footnotesize\ttfamily static void Time\+::delay\+Microseconds (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{us }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Referenced by delay\+Milliseconds(), Vortex\+Engine\+::enter\+Sleep(), VLSender\+::send\+Mark(), VLSender\+::send\+Space(), and tick\+Clock().

\mbox{\Hypertarget{classTime_aa90c5d6860ae306048c96d80da2ea1b0}\label{classTime_aa90c5d6860ae306048c96d80da2ea1b0}} 
\index{Time@{Time}!delayMilliseconds@{delayMilliseconds}}
\index{delayMilliseconds@{delayMilliseconds}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{delayMilliseconds()}{delayMilliseconds()}}
{\footnotesize\ttfamily void Time\+::delay\+Milliseconds (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{ms }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 248 of file Time\+Control.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{249 \{}
\DoxyCodeLine{250 \textcolor{preprocessor}{\#ifdef VORTEX\_EMBEDDED}}
\DoxyCodeLine{251   \textcolor{comment}{// not very accurate}}
\DoxyCodeLine{252   \textcolor{keywordflow}{for} (uint16\_t i = 0; i < ms; ++i) \{}
\DoxyCodeLine{253     \mbox{\hyperlink{classTime_a9682da1974a20a9bcdbb678984cd0e9c}{delayMicroseconds}}(1000);}
\DoxyCodeLine{254   \}}
\DoxyCodeLine{255 \textcolor{preprocessor}{\#elif defined(\_WIN32)}}
\DoxyCodeLine{256   Sleep(ms);}
\DoxyCodeLine{257 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{258   usleep(ms * 1000);}
\DoxyCodeLine{259 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{260 \}}

\end{DoxyCode}


References delay\+Microseconds().



Referenced by Leds\+::hold\+All().

\mbox{\Hypertarget{classTime_a7c7a8e067bdbd5aaf119521539d30940}\label{classTime_a7c7a8e067bdbd5aaf119521539d30940}} 
\index{Time@{Time}!getCurtime@{getCurtime}}
\index{getCurtime@{getCurtime}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{getCurtime()}{getCurtime()}}
{\footnotesize\ttfamily static uint32\+\_\+t Time\+::get\+Curtime (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Definition at line 40 of file Time\+Control.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{40 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{classTime_ac3f1dc3ad6b2ba8787643e73b17a4f1c}{m\_curTick}} + \mbox{\hyperlink{TimeControl_8h_a95da11cf4c5f8b3d234f62b7a44203c2}{SIMULATION\_TICK}}; \}}

\end{DoxyCode}


References m\+\_\+cur\+Tick, and SIMULATION\+\_\+\+TICK.



Referenced by Timer\+::alarm(), Leds\+::blink\+All(), Leds\+::blink\+Index(), Leds\+::blink\+Map(), Leds\+::blink\+Pair(), Leds\+::blink\+Pairs(), Leds\+::blink\+Range(), Serial\+Coms\+::check\+Serial(), Timer\+::on\+End(), Timer\+::on\+Start(), Menus\+::open\+Menu\+Selection(), Mode\+Sharing\+::receive\+Mode(), Randomizer\+::run(), Global\+Brightness\+::run\+Keychain\+Mode(), Vortex\+Engine\+::run\+Main\+Logic(), Menus\+::run\+Menu\+Selection(), VLSender\+::send(), Modes\+::set\+Cur\+Mode(), Global\+Brightness\+::set\+Keychain\+Mode\+State(), Color\+Select\+::show\+Full\+Set(), Color\+Select\+::show\+Selection(), Timer\+::start(), and Button\+::update().

\mbox{\Hypertarget{classTime_a719c88f4e11a83f7167f45a2a58f5d60}\label{classTime_a719c88f4e11a83f7167f45a2a58f5d60}} 
\index{Time@{Time}!getRealCurtime@{getRealCurtime}}
\index{getRealCurtime@{getRealCurtime}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{getRealCurtime()}{getRealCurtime()}}
{\footnotesize\ttfamily uint32\+\_\+t Time\+::get\+Real\+Curtime (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 135 of file Time\+Control.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{136 \{}
\DoxyCodeLine{137   \textcolor{keywordflow}{return} \mbox{\hyperlink{classTime_ac3f1dc3ad6b2ba8787643e73b17a4f1c}{m\_curTick}};}
\DoxyCodeLine{138 \}}

\end{DoxyCode}


References m\+\_\+cur\+Tick.

\mbox{\Hypertarget{classTime_acb7cd2d49094647c3fb7112e15ad16d7}\label{classTime_acb7cd2d49094647c3fb7112e15ad16d7}} 
\index{Time@{Time}!getTickrate@{getTickrate}}
\index{getTickrate@{getTickrate}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{getTickrate()}{getTickrate()}}
{\footnotesize\ttfamily uint32\+\_\+t Time\+::get\+Tickrate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 140 of file Time\+Control.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{141 \{}
\DoxyCodeLine{142   \textcolor{keywordflow}{return} \mbox{\hyperlink{TimeControl_8cpp_a7f21fe9fdb3605017d51d802b41910ac}{TICKRATE}};}
\DoxyCodeLine{143 \}}

\end{DoxyCode}


References TICKRATE.

\mbox{\Hypertarget{classTime_a0058db559daacf8050e8a0b1d4b9fd8c}\label{classTime_a0058db559daacf8050e8a0b1d4b9fd8c}} 
\index{Time@{Time}!init@{init}}
\index{init@{init}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily bool Time\+::init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 51 of file Time\+Control.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{52 \{}
\DoxyCodeLine{53 \textcolor{preprocessor}{\#ifdef VORTEX\_EMBEDDED}}
\DoxyCodeLine{54   \mbox{\hyperlink{classTime_a4006a9aa5cc0cf1276af05aade63bccc}{initMCUTime}}();}
\DoxyCodeLine{55 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{56   \mbox{\hyperlink{classTime_ac3f1dc3ad6b2ba8787643e73b17a4f1c}{m\_curTick}} = 0;}
\DoxyCodeLine{57 \textcolor{preprocessor}{\#if VARIABLE\_TICKRATE == 1}}
\DoxyCodeLine{58   m\_tickrate = \mbox{\hyperlink{VortexConfig_8h_a97f6a37590c60f131bba4007c88d16eb}{DEFAULT\_TICKRATE}};}
\DoxyCodeLine{59 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{60 \textcolor{preprocessor}{\#ifdef VORTEX\_LIB}}
\DoxyCodeLine{61   m\_firstTime = m\_prevTime = \mbox{\hyperlink{classTime_ac44f4e49538456714372bb1aad3dd839}{microseconds}}();}
\DoxyCodeLine{62   m\_simulationTick = 0;}
\DoxyCodeLine{63   m\_isSimulation = \textcolor{keyword}{false};}
\DoxyCodeLine{64   m\_instantTimestep = \textcolor{keyword}{false};}
\DoxyCodeLine{65 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{66 \textcolor{preprocessor}{\#if !defined(\_WIN32) || defined(WASM)}}
\DoxyCodeLine{67   \mbox{\hyperlink{TimeControl_8cpp_a6a51e9baeec9b06ae477cf6475efc71d}{start}} = \mbox{\hyperlink{classTime_ac44f4e49538456714372bb1aad3dd839}{microseconds}}();}
\DoxyCodeLine{68 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{69   QueryPerformanceFrequency(\&tps);}
\DoxyCodeLine{70   QueryPerformanceCounter(\&\mbox{\hyperlink{TimeControl_8cpp_a6a51e9baeec9b06ae477cf6475efc71d}{start}});}
\DoxyCodeLine{71 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{72   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{73 \}}

\end{DoxyCode}


References DEFAULT\+\_\+\+TICKRATE, init\+MCUTime(), m\+\_\+cur\+Tick, microseconds(), and start.



Referenced by Vortex\+Engine\+::init().

\mbox{\Hypertarget{classTime_a4006a9aa5cc0cf1276af05aade63bccc}\label{classTime_a4006a9aa5cc0cf1276af05aade63bccc}} 
\index{Time@{Time}!initMCUTime@{initMCUTime}}
\index{initMCUTime@{initMCUTime}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{initMCUTime()}{initMCUTime()}}
{\footnotesize\ttfamily void Time\+::init\+MCUTime (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 304 of file Time\+Control.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{305 \{}
\DoxyCodeLine{306   \textcolor{comment}{// initialize main clock}}
\DoxyCodeLine{307 \textcolor{preprocessor}{\#if (F\_CPU == 20000000)}}
\DoxyCodeLine{308   \textcolor{comment}{// No division on clock}}
\DoxyCodeLine{309   \_PROTECTED\_WRITE(CLKCTRL\_MCLKCTRLB, 0x00);}
\DoxyCodeLine{310 \textcolor{preprocessor}{\#elif (F\_CPU == 10000000)}}
\DoxyCodeLine{311   \textcolor{comment}{// 20MHz prescaled by 2, Clock DIV2}}
\DoxyCodeLine{312   \_PROTECTED\_WRITE(CLKCTRL\_MCLKCTRLB, (CLKCTRL\_PEN\_bm | CLKCTRL\_PDIV\_2X\_gc));}
\DoxyCodeLine{313 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{314 \textcolor{preprocessor}{  \#error "{}F\_CPU not supported"{}}}
\DoxyCodeLine{315 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{316 }
\DoxyCodeLine{317   \textcolor{comment}{// IVSEL = 1 means Interrupt vectors are placed at the start of the boot section of the Flash}}
\DoxyCodeLine{318   \textcolor{comment}{// as opposed to the application section of Flash. See 13.5.1}}
\DoxyCodeLine{319   \_PROTECTED\_WRITE(CPUINT\_CTRLA, CPUINT\_IVSEL\_bm);}
\DoxyCodeLine{320 \}}

\end{DoxyCode}


Referenced by init().

\mbox{\Hypertarget{classTime_ac44f4e49538456714372bb1aad3dd839}\label{classTime_ac44f4e49538456714372bb1aad3dd839}} 
\index{Time@{Time}!microseconds@{microseconds}}
\index{microseconds@{microseconds}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{microseconds()}{microseconds()}}
{\footnotesize\ttfamily uint32\+\_\+t Time\+::microseconds (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 180 of file Time\+Control.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{181 \{}
\DoxyCodeLine{182 \textcolor{preprocessor}{\#ifndef VORTEX\_LIB }\textcolor{comment}{// Embedded avr devices}}
\DoxyCodeLine{183   uint32\_t ticks;}
\DoxyCodeLine{184   \textcolor{comment}{// divide by 10}}
\DoxyCodeLine{185   ticks = (\mbox{\hyperlink{classTime_ac3f1dc3ad6b2ba8787643e73b17a4f1c}{m\_curTick}} * \mbox{\hyperlink{VortexConfig_8h_a97f6a37590c60f131bba4007c88d16eb}{DEFAULT\_TICKRATE}}) + (TCB0.CNT / 1000);}
\DoxyCodeLine{186   \textcolor{keywordflow}{return} ticks;}
\DoxyCodeLine{187 \textcolor{preprocessor}{\#elif defined(\_WIN32) }\textcolor{comment}{// windows}}
\DoxyCodeLine{188   LARGE\_INTEGER now;}
\DoxyCodeLine{189   QueryPerformanceCounter(\&now);}
\DoxyCodeLine{190   \textcolor{keywordflow}{if} (!tps.QuadPart) \{}
\DoxyCodeLine{191     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{192   \}}
\DoxyCodeLine{193   \textcolor{comment}{// yes, this will overflow, that's how arduino microseconds() works *shrug*}}
\DoxyCodeLine{194   \textcolor{keywordflow}{return} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})((now.QuadPart -\/ \mbox{\hyperlink{TimeControl_8cpp_a6a51e9baeec9b06ae477cf6475efc71d}{start}}.QuadPart) * 1000000 / tps.QuadPart);}
\DoxyCodeLine{195 \textcolor{preprocessor}{\#else }\textcolor{comment}{// linux/wasm/etc}}
\DoxyCodeLine{196   \textcolor{keyword}{struct }timespec ts;}
\DoxyCodeLine{197   clock\_gettime(CLOCK\_MONOTONIC\_RAW, \&ts);}
\DoxyCodeLine{198   uint64\_t us = \mbox{\hyperlink{TimeControl_8cpp_ad4fb94c1ab9cbc945f797df08da3fcf1}{SEC\_TO\_US}}((uint64\_t)ts.tv\_sec) + \mbox{\hyperlink{TimeControl_8cpp_aba379c651cac0789cf71828509fec881}{NS\_TO\_US}}((uint64\_t)ts.tv\_nsec);}
\DoxyCodeLine{199   \textcolor{keywordflow}{return} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})us;}
\DoxyCodeLine{200 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{201 \}}

\end{DoxyCode}


References DEFAULT\+\_\+\+TICKRATE, m\+\_\+cur\+Tick, NS\+\_\+\+TO\+\_\+\+US, SEC\+\_\+\+TO\+\_\+\+US, and start.



Referenced by \+\_\+\+\_\+attribute\+\_\+\+\_\+(), init(), VLReceiver\+::recv\+PCIHandler(), and tick\+Clock().

\mbox{\Hypertarget{classTime_aaf106aff340ea506f16a010b12f51769}\label{classTime_aaf106aff340ea506f16a010b12f51769}} 
\index{Time@{Time}!setTickrate@{setTickrate}}
\index{setTickrate@{setTickrate}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{setTickrate()}{setTickrate()}}
{\footnotesize\ttfamily void Time\+::set\+Tickrate (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{tickrate = {\ttfamily 0} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 147 of file Time\+Control.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{148 \{}
\DoxyCodeLine{149 \textcolor{preprocessor}{\#if VARIABLE\_TICKRATE == 1}}
\DoxyCodeLine{150   \textcolor{keywordflow}{if} (!tickrate) \{}
\DoxyCodeLine{151     \textcolor{comment}{// can't set 0 tickrate, so 0 sets default}}
\DoxyCodeLine{152     tickrate = \mbox{\hyperlink{VortexConfig_8h_a97f6a37590c60f131bba4007c88d16eb}{DEFAULT\_TICKRATE}};}
\DoxyCodeLine{153   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (tickrate > 1000000) \{}
\DoxyCodeLine{154     \textcolor{comment}{// more than 1 million ticks per second won't work anyway}}
\DoxyCodeLine{155     tickrate = 1000000;}
\DoxyCodeLine{156   \}}
\DoxyCodeLine{157   \textcolor{comment}{// update the tickrate}}
\DoxyCodeLine{158   m\_tickrate = tickrate;}
\DoxyCodeLine{159 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{160 \}}

\end{DoxyCode}


References DEFAULT\+\_\+\+TICKRATE.

\mbox{\Hypertarget{classTime_a823b10e685d34b667e16e36fea96e150}\label{classTime_a823b10e685d34b667e16e36fea96e150}} 
\index{Time@{Time}!tickClock@{tickClock}}
\index{tickClock@{tickClock}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{tickClock()}{tickClock()}}
{\footnotesize\ttfamily void Time\+::tick\+Clock (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 79 of file Time\+Control.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{80 \{}
\DoxyCodeLine{81   \textcolor{comment}{// tick clock forward}}
\DoxyCodeLine{82   \mbox{\hyperlink{classTime_ac3f1dc3ad6b2ba8787643e73b17a4f1c}{m\_curTick}}++;}
\DoxyCodeLine{83 }
\DoxyCodeLine{84 \textcolor{preprocessor}{\#if DEBUG\_ALLOCATIONS == 1}}
\DoxyCodeLine{85   \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classTime_ac3f1dc3ad6b2ba8787643e73b17a4f1c}{m\_curTick}} \% \mbox{\hyperlink{TimeControl_8h_a73adf9c10352865ff95b5f46e642c560}{MS\_TO\_TICKS}}(1000)) == 0) \{}
\DoxyCodeLine{86     \mbox{\hyperlink{Log_8h_a8bdccae09f7cdda8fb311e0bd81c35dc}{DEBUG\_LOGF}}(\textcolor{stringliteral}{"{}Cur Memory: \%u (\%u)"{}}, cur\_memory\_usage(), cur\_memory\_usage\_background());}
\DoxyCodeLine{87   \}}
\DoxyCodeLine{88 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90   \textcolor{comment}{// the rest of this only runs inside vortexlib because on the duo the tick runs in the}}
\DoxyCodeLine{91   \textcolor{comment}{// tcb timer callback instead of in a busy loop constantly checking microseconds()}}
\DoxyCodeLine{92 \textcolor{preprocessor}{\#ifdef VORTEX\_LIB}}
\DoxyCodeLine{93   \textcolor{keywordflow}{if} (m\_instantTimestep) \{}
\DoxyCodeLine{94     \textcolor{keywordflow}{return};}
\DoxyCodeLine{95   \}}
\DoxyCodeLine{96 }
\DoxyCodeLine{97   \textcolor{comment}{// perform timestep}}
\DoxyCodeLine{98   uint32\_t elapsed\_us;}
\DoxyCodeLine{99   uint32\_t us;}
\DoxyCodeLine{100   \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{101     us = \mbox{\hyperlink{classTime_ac44f4e49538456714372bb1aad3dd839}{microseconds}}();}
\DoxyCodeLine{102     \textcolor{comment}{// detect rollover of microsecond counter}}
\DoxyCodeLine{103     \textcolor{keywordflow}{if} (us < m\_prevTime) \{}
\DoxyCodeLine{104       \textcolor{comment}{// calculate wrapped around difference}}
\DoxyCodeLine{105       elapsed\_us = (uint32\_t)((UINT32\_MAX -\/ m\_prevTime) + us);}
\DoxyCodeLine{106     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{107       \textcolor{comment}{// otherwise calculate regular difference}}
\DoxyCodeLine{108       elapsed\_us = (uint32\_t)(us -\/ m\_prevTime);}
\DoxyCodeLine{109     \}}
\DoxyCodeLine{110     \textcolor{comment}{// if building anywhere except visual studio then we can run alternate sleep code}}
\DoxyCodeLine{111     \textcolor{comment}{// because in visual studio + windows it's better to just spin and check the high}}
\DoxyCodeLine{112     \textcolor{comment}{// resolution clock instead of trying to sleep for microseconds.}}
\DoxyCodeLine{113 \textcolor{preprocessor}{\#if !defined(\_WIN32) \&\& defined(VORTEX\_LIB)}}
\DoxyCodeLine{114     uint32\_t required = (1000000 / \mbox{\hyperlink{TimeControl_8cpp_a7f21fe9fdb3605017d51d802b41910ac}{TICKRATE}});}
\DoxyCodeLine{115     uint32\_t sleepTime = 0;}
\DoxyCodeLine{116     \textcolor{keywordflow}{if} (required > elapsed\_us) \{}
\DoxyCodeLine{117       \textcolor{comment}{// in vortex lib on linux we can just sleep instead of spinning}}
\DoxyCodeLine{118       \textcolor{comment}{// but on arduino we must spin and on windows it actually ends}}
\DoxyCodeLine{119       \textcolor{comment}{// up being more accurate to poll QPF + QPC via microseconds()}}
\DoxyCodeLine{120       sleepTime = required -\/ elapsed\_us;}
\DoxyCodeLine{121     \}}
\DoxyCodeLine{122     \mbox{\hyperlink{classTime_a9682da1974a20a9bcdbb678984cd0e9c}{Time::delayMicroseconds}}(sleepTime);}
\DoxyCodeLine{123     \textcolor{keywordflow}{break};}
\DoxyCodeLine{124 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{125     \textcolor{comment}{// 1000us per ms, divided by tickrate gives}}
\DoxyCodeLine{126     \textcolor{comment}{// the number of microseconds per tick}}
\DoxyCodeLine{127   \} \textcolor{keywordflow}{while} (elapsed\_us < (1000000 / \mbox{\hyperlink{TimeControl_8cpp_a7f21fe9fdb3605017d51d802b41910ac}{TICKRATE}}));}
\DoxyCodeLine{128 }
\DoxyCodeLine{129   \textcolor{comment}{// store current time}}
\DoxyCodeLine{130   m\_prevTime = \mbox{\hyperlink{classTime_ac44f4e49538456714372bb1aad3dd839}{microseconds}}();}
\DoxyCodeLine{131 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{132 \}}

\end{DoxyCode}


References DEBUG\+\_\+\+LOGF, delay\+Microseconds(), m\+\_\+cur\+Tick, microseconds(), MS\+\_\+\+TO\+\_\+\+TICKS, and TICKRATE.



Referenced by Vortex\+Engine\+::tick().



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classTime_ac3f1dc3ad6b2ba8787643e73b17a4f1c}\label{classTime_ac3f1dc3ad6b2ba8787643e73b17a4f1c}} 
\index{Time@{Time}!m\_curTick@{m\_curTick}}
\index{m\_curTick@{m\_curTick}!Time@{Time}}
\doxysubsubsection{\texorpdfstring{m\_curTick}{m\_curTick}}
{\footnotesize\ttfamily uint32\+\_\+t Time\+::m\+\_\+cur\+Tick = 0\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 118 of file Time\+Control.\+h.



Referenced by get\+Curtime(), get\+Real\+Curtime(), init(), microseconds(), and tick\+Clock().



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
Vortex\+Engine/src/\+Time/\mbox{\hyperlink{TimeControl_8h}{Time\+Control.\+h}}\item 
Vortex\+Engine/src/\+Time/\mbox{\hyperlink{TimeControl_8cpp}{Time\+Control.\+cpp}}\end{DoxyCompactItemize}
