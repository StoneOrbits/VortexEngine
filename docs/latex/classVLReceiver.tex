\hypertarget{classVLReceiver}{}\doxysection{VLReceiver Class Reference}
\label{classVLReceiver}\index{VLReceiver@{VLReceiver}}


{\ttfamily \#include $<$VLReceiver.\+h$>$}



Collaboration diagram for VLReceiver\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=167pt]{classVLReceiver__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static bool \mbox{\hyperlink{classVLReceiver_a406cd003a5d26bfe07470261fdb022c1}{init}} ()
\item 
static void \mbox{\hyperlink{classVLReceiver_a31fba601a6e82bc043c7d017d91ce015}{cleanup}} ()
\item 
static bool \mbox{\hyperlink{classVLReceiver_aece2971f1778af65459a3db1cb9eda0d}{data\+Ready}} ()
\item 
static bool \mbox{\hyperlink{classVLReceiver_a70272e1e665654e412f59dfd2dc15bc2}{is\+Receiving}} ()
\item 
static uint8\+\_\+t \mbox{\hyperlink{classVLReceiver_af8c3fce495ebd5f50e5bcf73554f28d2}{percent\+Received}} ()
\item 
static uint16\+\_\+t \mbox{\hyperlink{classVLReceiver_a51aa07da22215b8de62bcc32e9a49c95}{bytes\+Received}} ()
\item 
static bool \mbox{\hyperlink{classVLReceiver_add2bca7d2ad4e1f3653f04be9a6e3d21}{receive\+Mode}} (\mbox{\hyperlink{classMode}{Mode}} $\ast$p\+Mode)
\item 
static bool \mbox{\hyperlink{classVLReceiver_a9fd384549b9fbbdc8267131e052e0b69}{begin\+Receiving}} ()
\item 
static bool \mbox{\hyperlink{classVLReceiver_a63a96c6ce982079256319b07f573006b}{end\+Receiving}} ()
\item 
static bool \mbox{\hyperlink{classVLReceiver_a52b51c60db0419167aabdfe1f5d9a3e6}{on\+New\+Data}} ()
\item 
static void \mbox{\hyperlink{classVLReceiver_a9d711ae64327b2b26c168478f92231b1}{reset\+VLState}} ()
\item 
static void \mbox{\hyperlink{classVLReceiver_ada08a00c52a7d4aa531c332b358b386f}{recv\+PCIHandler}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Private Types}
\begin{DoxyCompactItemize}
\item 
enum \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8}{Recv\+State}} \+: uint8\+\_\+t \{ \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a47c2b836e3c6a3cd2b63e572fcaaa434}{WAITING\+\_\+\+HEADER\+\_\+\+MARK}}
, \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8aabd2b5abd329faa79b2af1f985e3d64d}{WAITING\+\_\+\+HEADER\+\_\+\+SPACE}}
, \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a85d1974b6b9c4a9cf8cf6ad8105019af}{READING\+\_\+\+DATA\+\_\+\+MARK}}
, \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a8b4cf7c43de19caaa96a6c9a81530370}{READING\+\_\+\+DATA\+\_\+\+SPACE}}
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classVLReceiver_abb237cfc49d5dfa4179a1602735cf69f}{VLReceiver}} ()
\item 
void \mbox{\hyperlink{classVLReceiver_a1e6130b83e611e7d9a9abbaf0429d6c0}{adc\+Check\+Timer\+Callback}} (void $\ast$arg)
\end{DoxyCompactItemize}
\doxysubsection*{Static Private Member Functions}
\begin{DoxyCompactItemize}
\item 
static bool \mbox{\hyperlink{classVLReceiver_ab46186e351091b92acdfe8bae1503f68}{read}} (\mbox{\hyperlink{classByteStream}{Byte\+Stream}} \&data)
\item 
static void \mbox{\hyperlink{classVLReceiver_a09b9dcb3e525815baf74092e70ef5ab0}{handle\+VLTiming}} (uint32\+\_\+t diff)
\end{DoxyCompactItemize}
\doxysubsection*{Static Private Attributes}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{classBitStream}{Bit\+Stream}} \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\+\_\+vl\+Data}}
\item 
static \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8}{Recv\+State}} \mbox{\hyperlink{classVLReceiver_acf1c828ff43b3bf218975e61ed9a4f51}{m\+\_\+recv\+State}} = \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a47c2b836e3c6a3cd2b63e572fcaaa434}{WAITING\+\_\+\+HEADER\+\_\+\+MARK}}
\item 
static uint32\+\_\+t \mbox{\hyperlink{classVLReceiver_a48be4a0ea04c428f7ddd0fa9723a7c35}{m\+\_\+prev\+Time}} = 0
\item 
static uint8\+\_\+t \mbox{\hyperlink{classVLReceiver_aa56911b2c08cbff0a1d5e2685d7506f9}{m\+\_\+pin\+State}} = 0
\item 
static uint32\+\_\+t \mbox{\hyperlink{classVLReceiver_a21679e3a4a6e2de40c74804a46572bfd}{m\+\_\+previous\+Bytes}} = 0
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 19 of file VLReceiver.\+h.



\doxysubsection{Member Enumeration Documentation}
\mbox{\Hypertarget{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8}\label{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8}} 
\index{VLReceiver@{VLReceiver}!RecvState@{RecvState}}
\index{RecvState@{RecvState}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{RecvState}{RecvState}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8}{VLReceiver\+::\+Recv\+State}} \+: uint8\+\_\+t\hspace{0.3cm}{\ttfamily [private]}}

\begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{WAITING\_HEADER\_MARK@{WAITING\_HEADER\_MARK}!VLReceiver@{VLReceiver}}\index{VLReceiver@{VLReceiver}!WAITING\_HEADER\_MARK@{WAITING\_HEADER\_MARK}}}\mbox{\Hypertarget{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a47c2b836e3c6a3cd2b63e572fcaaa434}\label{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a47c2b836e3c6a3cd2b63e572fcaaa434}} 
WAITING\+\_\+\+HEADER\+\_\+\+MARK&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{WAITING\_HEADER\_SPACE@{WAITING\_HEADER\_SPACE}!VLReceiver@{VLReceiver}}\index{VLReceiver@{VLReceiver}!WAITING\_HEADER\_SPACE@{WAITING\_HEADER\_SPACE}}}\mbox{\Hypertarget{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8aabd2b5abd329faa79b2af1f985e3d64d}\label{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8aabd2b5abd329faa79b2af1f985e3d64d}} 
WAITING\+\_\+\+HEADER\+\_\+\+SPACE&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{READING\_DATA\_MARK@{READING\_DATA\_MARK}!VLReceiver@{VLReceiver}}\index{VLReceiver@{VLReceiver}!READING\_DATA\_MARK@{READING\_DATA\_MARK}}}\mbox{\Hypertarget{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a85d1974b6b9c4a9cf8cf6ad8105019af}\label{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a85d1974b6b9c4a9cf8cf6ad8105019af}} 
READING\+\_\+\+DATA\+\_\+\+MARK&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{READING\_DATA\_SPACE@{READING\_DATA\_SPACE}!VLReceiver@{VLReceiver}}\index{VLReceiver@{VLReceiver}!READING\_DATA\_SPACE@{READING\_DATA\_SPACE}}}\mbox{\Hypertarget{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a8b4cf7c43de19caaa96a6c9a81530370}\label{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a8b4cf7c43de19caaa96a6c9a81530370}} 
READING\+\_\+\+DATA\+\_\+\+SPACE&\\
\hline

\end{DoxyEnumFields}


Definition at line 63 of file VLReceiver.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{64   \{}
\DoxyCodeLine{65     \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a47c2b836e3c6a3cd2b63e572fcaaa434}{WAITING\_HEADER\_MARK}},}
\DoxyCodeLine{66     \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8aabd2b5abd329faa79b2af1f985e3d64d}{WAITING\_HEADER\_SPACE}},}
\DoxyCodeLine{67     \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a85d1974b6b9c4a9cf8cf6ad8105019af}{READING\_DATA\_MARK}},}
\DoxyCodeLine{68     \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a8b4cf7c43de19caaa96a6c9a81530370}{READING\_DATA\_SPACE}}}
\DoxyCodeLine{69   \};}

\end{DoxyCode}


\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classVLReceiver_abb237cfc49d5dfa4179a1602735cf69f}\label{classVLReceiver_abb237cfc49d5dfa4179a1602735cf69f}} 
\index{VLReceiver@{VLReceiver}!VLReceiver@{VLReceiver}}
\index{VLReceiver@{VLReceiver}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{VLReceiver()}{VLReceiver()}}
{\footnotesize\ttfamily VLReceiver\+::\+VLReceiver (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classVLReceiver_a1e6130b83e611e7d9a9abbaf0429d6c0}\label{classVLReceiver_a1e6130b83e611e7d9a9abbaf0429d6c0}} 
\index{VLReceiver@{VLReceiver}!adcCheckTimerCallback@{adcCheckTimerCallback}}
\index{adcCheckTimerCallback@{adcCheckTimerCallback}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{adcCheckTimerCallback()}{adcCheckTimerCallback()}}
{\footnotesize\ttfamily void VLReceiver\+::adc\+Check\+Timer\+Callback (\begin{DoxyParamCaption}\item[{void $\ast$}]{arg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 49 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{50 \{}
\DoxyCodeLine{51   \textcolor{keyword}{static} \textcolor{keywordtype}{bool} wasAboveThreshold = \textcolor{keyword}{false};}
\DoxyCodeLine{52   uint32\_t val = adc1\_get\_raw(\mbox{\hyperlink{VLReceiver_8cpp_a7fb9fde533f9b9bc8e4ae31524c9ea51}{ADC\_CHANNEL}});}
\DoxyCodeLine{53   \textcolor{keywordflow}{if} (val > \mbox{\hyperlink{VLReceiver_8cpp_aa3c9d5bc3f1c3dfec69046200aecb29a}{MIN\_THRESHOLD}} \&\& val < (\mbox{\hyperlink{VLReceiver_8cpp_aa63db45b7c328128e07cd4d0f86f59df}{threshold}} + \mbox{\hyperlink{VLReceiver_8cpp_ac97aa4e68f9c89b8c71d011b0956de1f}{BASE\_OFFSET}})) \{}
\DoxyCodeLine{54     \mbox{\hyperlink{VLReceiver_8cpp_aa63db45b7c328128e07cd4d0f86f59df}{threshold}} = val + \mbox{\hyperlink{VLReceiver_8cpp_ac97aa4e68f9c89b8c71d011b0956de1f}{BASE\_OFFSET}};}
\DoxyCodeLine{55   \}}
\DoxyCodeLine{56   \textcolor{keywordtype}{bool} isAboveThreshold = (val > \mbox{\hyperlink{VLReceiver_8cpp_aa63db45b7c328128e07cd4d0f86f59df}{threshold}});}
\DoxyCodeLine{57   \textcolor{keywordflow}{if} (wasAboveThreshold != isAboveThreshold) \{}
\DoxyCodeLine{58     wasAboveThreshold = isAboveThreshold;}
\DoxyCodeLine{59     \mbox{\hyperlink{classVLReceiver_ada08a00c52a7d4aa531c332b358b386f}{VLReceiver::recvPCIHandler}}();}
\DoxyCodeLine{60   \}}
\DoxyCodeLine{61 \}}

\end{DoxyCode}


References ADC\+\_\+\+CHANNEL, BASE\+\_\+\+OFFSET, MIN\+\_\+\+THRESHOLD, recv\+PCIHandler(), and threshold.



Referenced by begin\+Receiving().

\mbox{\Hypertarget{classVLReceiver_a9fd384549b9fbbdc8267131e052e0b69}\label{classVLReceiver_a9fd384549b9fbbdc8267131e052e0b69}} 
\index{VLReceiver@{VLReceiver}!beginReceiving@{beginReceiving}}
\index{beginReceiving@{beginReceiving}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{beginReceiving()}{beginReceiving()}}
{\footnotesize\ttfamily bool VLReceiver\+::begin\+Receiving (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 134 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{135 \{}
\DoxyCodeLine{136 \textcolor{preprocessor}{\#ifdef VORTEX\_EMBEDDED}}
\DoxyCodeLine{137   \textcolor{keywordflow}{if} (\mbox{\hyperlink{VLReceiver_8cpp_a5297ef2d8c460fc39919e9bdd8f65395}{periodic\_timer}} != \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{138     \mbox{\hyperlink{Log_8h_a5d2f30bd1cbcf49f829a7e8eb6173c06}{DEBUG\_LOG}}(\textcolor{stringliteral}{"{}VL Reception already running."{}});}
\DoxyCodeLine{139     \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \textcolor{comment}{// Timer is already running}}
\DoxyCodeLine{140   \}}
\DoxyCodeLine{141   \textcolor{comment}{// Initialize timer for periodic ADC checks}}
\DoxyCodeLine{142   \textcolor{keyword}{const} esp\_timer\_create\_args\_t periodic\_timer\_args = \{}
\DoxyCodeLine{143       .callback = (void (*)(\textcolor{keywordtype}{void}*))\&\mbox{\hyperlink{classVLReceiver_a1e6130b83e611e7d9a9abbaf0429d6c0}{VLReceiver::adcCheckTimerCallback}},}
\DoxyCodeLine{144       .name = \textcolor{stringliteral}{"{}adc\_check\_timer"{}}}
\DoxyCodeLine{145   \};}
\DoxyCodeLine{146   esp\_timer\_handle\_t \mbox{\hyperlink{VLReceiver_8cpp_a5297ef2d8c460fc39919e9bdd8f65395}{periodic\_timer}};}
\DoxyCodeLine{147   ESP\_ERROR\_CHECK(esp\_timer\_create(\&periodic\_timer\_args, \&\mbox{\hyperlink{VLReceiver_8cpp_a5297ef2d8c460fc39919e9bdd8f65395}{periodic\_timer}}));}
\DoxyCodeLine{148   ESP\_ERROR\_CHECK(esp\_timer\_start\_periodic(\mbox{\hyperlink{VLReceiver_8cpp_a5297ef2d8c460fc39919e9bdd8f65395}{periodic\_timer}}, \mbox{\hyperlink{VLReceiver_8cpp_aef840d83bcb6c342657b135c42095391}{TIMER\_INTERVAL\_MICRO\_SEC}}));}
\DoxyCodeLine{149 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{150   \mbox{\hyperlink{classVLReceiver_a9d711ae64327b2b26c168478f92231b1}{resetVLState}}();}
\DoxyCodeLine{151   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{152 \}}

\end{DoxyCode}


References adc\+Check\+Timer\+Callback(), DEBUG\+\_\+\+LOG, periodic\+\_\+timer, reset\+VLState(), and TIMER\+\_\+\+INTERVAL\+\_\+\+MICRO\+\_\+\+SEC.



Referenced by Mode\+Sharing\+::begin\+Receiving\+VL().

\mbox{\Hypertarget{classVLReceiver_a51aa07da22215b8de62bcc32e9a49c95}\label{classVLReceiver_a51aa07da22215b8de62bcc32e9a49c95}} 
\index{VLReceiver@{VLReceiver}!bytesReceived@{bytesReceived}}
\index{bytesReceived@{bytesReceived}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{bytesReceived()}{bytesReceived()}}
{\footnotesize\ttfamily static uint16\+\_\+t VLReceiver\+::bytes\+Received (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Definition at line 34 of file VLReceiver.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{34 \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a6e99106ef46e33b45c8bcd51c0384a3f}{bytepos}}(); \}}

\end{DoxyCode}


References Bit\+Stream\+::bytepos(), and m\+\_\+vl\+Data.



Referenced by on\+New\+Data().

\mbox{\Hypertarget{classVLReceiver_a31fba601a6e82bc043c7d017d91ce015}\label{classVLReceiver_a31fba601a6e82bc043c7d017d91ce015}} 
\index{VLReceiver@{VLReceiver}!cleanup@{cleanup}}
\index{cleanup@{cleanup}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{cleanup()}{cleanup()}}
{\footnotesize\ttfamily void VLReceiver\+::cleanup (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 74 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{75 \{}
\DoxyCodeLine{76 \}}

\end{DoxyCode}


Referenced by Vortex\+Engine\+::cleanup().

\mbox{\Hypertarget{classVLReceiver_aece2971f1778af65459a3db1cb9eda0d}\label{classVLReceiver_aece2971f1778af65459a3db1cb9eda0d}} 
\index{VLReceiver@{VLReceiver}!dataReady@{dataReady}}
\index{dataReady@{dataReady}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{dataReady()}{dataReady()}}
{\footnotesize\ttfamily bool VLReceiver\+::data\+Ready (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 78 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{79 \{}
\DoxyCodeLine{80   \textcolor{comment}{// is the receiver actually receiving data?}}
\DoxyCodeLine{81   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classVLReceiver_a70272e1e665654e412f59dfd2dc15bc2}{isReceiving}}()) \{}
\DoxyCodeLine{82     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{83   \}}
\DoxyCodeLine{84   uint8\_t blocks = \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a4be1b1c1cb2684d2997b1c8a6f0cd34d}{data}}()[0];}
\DoxyCodeLine{85   uint8\_t remainder = \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a4be1b1c1cb2684d2997b1c8a6f0cd34d}{data}}()[1];}
\DoxyCodeLine{86   uint32\_t total = ((blocks -\/ 1) * 32) + remainder;}
\DoxyCodeLine{87   \textcolor{keywordflow}{if} (!total || total > \mbox{\hyperlink{VLConfig_8h_a5531f46c73b52342bc76a5423252c745}{VL\_MAX\_DATA\_TRANSFER}}) \{}
\DoxyCodeLine{88     \mbox{\hyperlink{Log_8h_a8bdccae09f7cdda8fb311e0bd81c35dc}{DEBUG\_LOGF}}(\textcolor{stringliteral}{"{}Bad VL Data size: \%u"{}}, total);}
\DoxyCodeLine{89     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{90   \}}
\DoxyCodeLine{91   \textcolor{comment}{// if there are size + 2 bytes in the VLData receiver}}
\DoxyCodeLine{92   \textcolor{comment}{// then a full message is ready, the + 2 is from the}}
\DoxyCodeLine{93   \textcolor{comment}{// two bytes for blocks + remainder that are sent first}}
\DoxyCodeLine{94   \textcolor{keywordflow}{return} (\mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a6e99106ef46e33b45c8bcd51c0384a3f}{bytepos}}() >= (uint32\_t)(total + 2));}
\DoxyCodeLine{95 \}}

\end{DoxyCode}


References Bit\+Stream\+::bytepos(), Bit\+Stream\+::data(), DEBUG\+\_\+\+LOGF, is\+Receiving(), m\+\_\+vl\+Data, and VL\+\_\+\+MAX\+\_\+\+DATA\+\_\+\+TRANSFER.



Referenced by Mode\+Sharing\+::receive\+Mode\+VL().

\mbox{\Hypertarget{classVLReceiver_a63a96c6ce982079256319b07f573006b}\label{classVLReceiver_a63a96c6ce982079256319b07f573006b}} 
\index{VLReceiver@{VLReceiver}!endReceiving@{endReceiving}}
\index{endReceiving@{endReceiving}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{endReceiving()}{endReceiving()}}
{\footnotesize\ttfamily bool VLReceiver\+::end\+Receiving (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 154 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{155 \{}
\DoxyCodeLine{156 \textcolor{preprocessor}{\#ifdef VORTEX\_EMBEDDED}}
\DoxyCodeLine{157   \textcolor{keywordflow}{if} (\mbox{\hyperlink{VLReceiver_8cpp_a5297ef2d8c460fc39919e9bdd8f65395}{periodic\_timer}} == \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{158     \mbox{\hyperlink{Log_8h_a5d2f30bd1cbcf49f829a7e8eb6173c06}{DEBUG\_LOG}}(\textcolor{stringliteral}{"{}VL Reception was not running."{}});}
\DoxyCodeLine{159     \textcolor{keywordflow}{return} \textcolor{keyword}{false}; \textcolor{comment}{// Timer was not running}}
\DoxyCodeLine{160   \}}
\DoxyCodeLine{161   \textcolor{comment}{// Stop and delete the timer}}
\DoxyCodeLine{162   ESP\_ERROR\_CHECK(esp\_timer\_stop(\mbox{\hyperlink{VLReceiver_8cpp_a5297ef2d8c460fc39919e9bdd8f65395}{periodic\_timer}}));}
\DoxyCodeLine{163   ESP\_ERROR\_CHECK(esp\_timer\_delete(\mbox{\hyperlink{VLReceiver_8cpp_a5297ef2d8c460fc39919e9bdd8f65395}{periodic\_timer}}));}
\DoxyCodeLine{164   \mbox{\hyperlink{VLReceiver_8cpp_a5297ef2d8c460fc39919e9bdd8f65395}{periodic\_timer}} = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{165   \mbox{\hyperlink{Log_8h_a5d2f30bd1cbcf49f829a7e8eb6173c06}{DEBUG\_LOG}}(\textcolor{stringliteral}{"{}VL Reception stopped."{}});}
\DoxyCodeLine{166 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{167   \mbox{\hyperlink{classVLReceiver_a9d711ae64327b2b26c168478f92231b1}{resetVLState}}();}
\DoxyCodeLine{168   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{169 \}}

\end{DoxyCode}


References DEBUG\+\_\+\+LOG, periodic\+\_\+timer, and reset\+VLState().



Referenced by Mode\+Sharing\+::on\+Short\+Click().

\mbox{\Hypertarget{classVLReceiver_a09b9dcb3e525815baf74092e70ef5ab0}\label{classVLReceiver_a09b9dcb3e525815baf74092e70ef5ab0}} 
\index{VLReceiver@{VLReceiver}!handleVLTiming@{handleVLTiming}}
\index{handleVLTiming@{handleVLTiming}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{handleVLTiming()}{handleVLTiming()}}
{\footnotesize\ttfamily void VLReceiver\+::handle\+VLTiming (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{diff }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 230 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{231 \{}
\DoxyCodeLine{232   \textcolor{comment}{// if the diff is too long or too short then it's not useful}}
\DoxyCodeLine{233   \textcolor{keywordflow}{if} ((diff > \mbox{\hyperlink{VLConfig_8h_a69a47bf818637f670f5e0297b0a14494}{VL\_HEADER\_MARK\_MAX}} \&\& \mbox{\hyperlink{classVLReceiver_acf1c828ff43b3bf218975e61ed9a4f51}{m\_recvState}} < \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a85d1974b6b9c4a9cf8cf6ad8105019af}{READING\_DATA\_MARK}}) || diff < \mbox{\hyperlink{VLConfig_8h_a4da43561aa22e37bd47c2cbc0f91b3b6}{VL\_TIMING\_MIN}}) \{}
\DoxyCodeLine{234     \mbox{\hyperlink{Log_8h_a8bdccae09f7cdda8fb311e0bd81c35dc}{DEBUG\_LOGF}}(\textcolor{stringliteral}{"{}bad delay: \%u, resetting..."{}}, diff);}
\DoxyCodeLine{235     \mbox{\hyperlink{classVLReceiver_a9d711ae64327b2b26c168478f92231b1}{resetVLState}}();}
\DoxyCodeLine{236     \textcolor{keywordflow}{return};}
\DoxyCodeLine{237   \}}
\DoxyCodeLine{238   \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classVLReceiver_acf1c828ff43b3bf218975e61ed9a4f51}{m\_recvState}}) \{}
\DoxyCodeLine{239   \textcolor{keywordflow}{case} \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a47c2b836e3c6a3cd2b63e572fcaaa434}{WAITING\_HEADER\_MARK}}: \textcolor{comment}{// initial state}}
\DoxyCodeLine{240     \textcolor{keywordflow}{if} (diff >= \mbox{\hyperlink{VLConfig_8h_a1b3bcb9ee4d252ec51e0158a25bcc447}{VL\_HEADER\_SPACE\_MIN}} \&\& diff <= \mbox{\hyperlink{VLConfig_8h_a69a47bf818637f670f5e0297b0a14494}{VL\_HEADER\_MARK\_MAX}}) \{}
\DoxyCodeLine{241       \mbox{\hyperlink{classVLReceiver_acf1c828ff43b3bf218975e61ed9a4f51}{m\_recvState}} = \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8aabd2b5abd329faa79b2af1f985e3d64d}{WAITING\_HEADER\_SPACE}};}
\DoxyCodeLine{242     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{243       \mbox{\hyperlink{Log_8h_a8bdccae09f7cdda8fb311e0bd81c35dc}{DEBUG\_LOGF}}(\textcolor{stringliteral}{"{}Bad header mark \%u, resetting..."{}}, diff);}
\DoxyCodeLine{244       \mbox{\hyperlink{classVLReceiver_a9d711ae64327b2b26c168478f92231b1}{resetVLState}}();}
\DoxyCodeLine{245     \}}
\DoxyCodeLine{246     \textcolor{keywordflow}{break};}
\DoxyCodeLine{247   \textcolor{keywordflow}{case} \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8aabd2b5abd329faa79b2af1f985e3d64d}{WAITING\_HEADER\_SPACE}}:}
\DoxyCodeLine{248     \textcolor{keywordflow}{if} (diff >= \mbox{\hyperlink{VLConfig_8h_a1b3bcb9ee4d252ec51e0158a25bcc447}{VL\_HEADER\_SPACE\_MIN}} \&\& diff <= \mbox{\hyperlink{VLConfig_8h_a69a47bf818637f670f5e0297b0a14494}{VL\_HEADER\_MARK\_MAX}}) \{}
\DoxyCodeLine{249       \mbox{\hyperlink{classVLReceiver_acf1c828ff43b3bf218975e61ed9a4f51}{m\_recvState}} = \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a85d1974b6b9c4a9cf8cf6ad8105019af}{READING\_DATA\_MARK}};}
\DoxyCodeLine{250     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{251       \mbox{\hyperlink{Log_8h_a8bdccae09f7cdda8fb311e0bd81c35dc}{DEBUG\_LOGF}}(\textcolor{stringliteral}{"{}Bad header space \%u, resetting..."{}}, diff);}
\DoxyCodeLine{252       \mbox{\hyperlink{classVLReceiver_a9d711ae64327b2b26c168478f92231b1}{resetVLState}}();}
\DoxyCodeLine{253     \}}
\DoxyCodeLine{254     \textcolor{keywordflow}{break};}
\DoxyCodeLine{255   \textcolor{keywordflow}{case} \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a85d1974b6b9c4a9cf8cf6ad8105019af}{READING\_DATA\_MARK}}:}
\DoxyCodeLine{256     \textcolor{comment}{// classify mark/space based on the timing and write into buffer}}
\DoxyCodeLine{257     \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a61fad4017cd117aad8c90d91057d2ba3}{write1Bit}}((diff > (\mbox{\hyperlink{VLConfig_8h_a0ec0a4d9a48be677d4d923eadcefe6ce}{VL\_TIMING}} * 2)) ? 1 : 0);}
\DoxyCodeLine{258     \mbox{\hyperlink{classVLReceiver_acf1c828ff43b3bf218975e61ed9a4f51}{m\_recvState}} = \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a8b4cf7c43de19caaa96a6c9a81530370}{READING\_DATA\_SPACE}};}
\DoxyCodeLine{259     \textcolor{keywordflow}{break};}
\DoxyCodeLine{260   \textcolor{keywordflow}{case} \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a8b4cf7c43de19caaa96a6c9a81530370}{READING\_DATA\_SPACE}}:}
\DoxyCodeLine{261     \textcolor{comment}{// the space could be just a regular space, or a gap in between blocks}}
\DoxyCodeLine{262     \mbox{\hyperlink{classVLReceiver_acf1c828ff43b3bf218975e61ed9a4f51}{m\_recvState}} = \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a85d1974b6b9c4a9cf8cf6ad8105019af}{READING\_DATA\_MARK}};}
\DoxyCodeLine{263     \textcolor{keywordflow}{break};}
\DoxyCodeLine{264   \textcolor{keywordflow}{default}: \textcolor{comment}{// ??}}
\DoxyCodeLine{265     \mbox{\hyperlink{Log_8h_a8bdccae09f7cdda8fb311e0bd81c35dc}{DEBUG\_LOGF}}(\textcolor{stringliteral}{"{}Bad receive state: \%u"{}}, \mbox{\hyperlink{classVLReceiver_acf1c828ff43b3bf218975e61ed9a4f51}{m\_recvState}});}
\DoxyCodeLine{266     \textcolor{keywordflow}{break};}
\DoxyCodeLine{267   \}}
\DoxyCodeLine{268 \}}

\end{DoxyCode}


References DEBUG\+\_\+\+LOGF, m\+\_\+recv\+State, m\+\_\+vl\+Data, READING\+\_\+\+DATA\+\_\+\+MARK, READING\+\_\+\+DATA\+\_\+\+SPACE, reset\+VLState(), VL\+\_\+\+HEADER\+\_\+\+MARK\+\_\+\+MAX, VL\+\_\+\+HEADER\+\_\+\+SPACE\+\_\+\+MIN, VL\+\_\+\+TIMING, VL\+\_\+\+TIMING\+\_\+\+MIN, WAITING\+\_\+\+HEADER\+\_\+\+MARK, WAITING\+\_\+\+HEADER\+\_\+\+SPACE, and Bit\+Stream\+::write1\+Bit().

\mbox{\Hypertarget{classVLReceiver_a406cd003a5d26bfe07470261fdb022c1}\label{classVLReceiver_a406cd003a5d26bfe07470261fdb022c1}} 
\index{VLReceiver@{VLReceiver}!init@{init}}
\index{init@{init}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily bool VLReceiver\+::init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 64 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{65 \{}
\DoxyCodeLine{66 \textcolor{preprocessor}{\#ifdef VORTEX\_EMBEDDED}}
\DoxyCodeLine{67   \textcolor{comment}{// Initialize ADC for GPIO1 (or appropriate pin connected to your light sensor)}}
\DoxyCodeLine{68   adc1\_config\_width(ADC\_WIDTH\_BIT\_12);}
\DoxyCodeLine{69   adc1\_config\_channel\_atten(\mbox{\hyperlink{VLReceiver_8cpp_a7fb9fde533f9b9bc8e4ae31524c9ea51}{ADC\_CHANNEL}}, ADC\_ATTEN\_DB\_0);}
\DoxyCodeLine{70 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{71   \textcolor{keywordflow}{return} \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a5b8f42bd95138304249dd9bcd6dcbb2c}{init}}(\mbox{\hyperlink{VLConfig_8h_a3d88d00f25aa3f045093b65ddf9f234d}{VL\_RECV\_BUF\_SIZE}});}
\DoxyCodeLine{72 \}}

\end{DoxyCode}


References ADC\+\_\+\+CHANNEL, Bit\+Stream\+::init(), m\+\_\+vl\+Data, and VL\+\_\+\+RECV\+\_\+\+BUF\+\_\+\+SIZE.



Referenced by Vortex\+Engine\+::init().

\mbox{\Hypertarget{classVLReceiver_a70272e1e665654e412f59dfd2dc15bc2}\label{classVLReceiver_a70272e1e665654e412f59dfd2dc15bc2}} 
\index{VLReceiver@{VLReceiver}!isReceiving@{isReceiving}}
\index{isReceiving@{isReceiving}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{isReceiving()}{isReceiving()}}
{\footnotesize\ttfamily bool VLReceiver\+::is\+Receiving (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 98 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{99 \{}
\DoxyCodeLine{100   \textcolor{comment}{// if there are at least 2 bytes in the data buffer then}}
\DoxyCodeLine{101   \textcolor{comment}{// the receiver is receiving a packet. If there is less}}
\DoxyCodeLine{102   \textcolor{comment}{// than 2 bytes then we're still waiting for the 'blocks'}}
\DoxyCodeLine{103   \textcolor{comment}{// and 'remainder' bytes which prefix a packet}}
\DoxyCodeLine{104   \textcolor{keywordflow}{return} (\mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a6e99106ef46e33b45c8bcd51c0384a3f}{bytepos}}() > 2);}
\DoxyCodeLine{105 \}}

\end{DoxyCode}


References Bit\+Stream\+::bytepos(), and m\+\_\+vl\+Data.



Referenced by data\+Ready(), percent\+Received(), and Mode\+Sharing\+::show\+Receive\+Mode().

\mbox{\Hypertarget{classVLReceiver_a52b51c60db0419167aabdfe1f5d9a3e6}\label{classVLReceiver_a52b51c60db0419167aabdfe1f5d9a3e6}} 
\index{VLReceiver@{VLReceiver}!onNewData@{onNewData}}
\index{onNewData@{onNewData}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{onNewData()}{onNewData()}}
{\footnotesize\ttfamily bool VLReceiver\+::on\+New\+Data (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 171 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{172 \{}
\DoxyCodeLine{173   \textcolor{keywordflow}{if} (\mbox{\hyperlink{classVLReceiver_a51aa07da22215b8de62bcc32e9a49c95}{bytesReceived}}() == \mbox{\hyperlink{classVLReceiver_a21679e3a4a6e2de40c74804a46572bfd}{m\_previousBytes}}) \{}
\DoxyCodeLine{174     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{175   \}}
\DoxyCodeLine{176   \mbox{\hyperlink{classVLReceiver_a21679e3a4a6e2de40c74804a46572bfd}{m\_previousBytes}} = \mbox{\hyperlink{classVLReceiver_a51aa07da22215b8de62bcc32e9a49c95}{bytesReceived}}();}
\DoxyCodeLine{177   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{178 \}}

\end{DoxyCode}


References bytes\+Received(), and m\+\_\+previous\+Bytes.



Referenced by Mode\+Sharing\+::receive\+Mode\+VL().

\mbox{\Hypertarget{classVLReceiver_af8c3fce495ebd5f50e5bcf73554f28d2}\label{classVLReceiver_af8c3fce495ebd5f50e5bcf73554f28d2}} 
\index{VLReceiver@{VLReceiver}!percentReceived@{percentReceived}}
\index{percentReceived@{percentReceived}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{percentReceived()}{percentReceived()}}
{\footnotesize\ttfamily uint8\+\_\+t VLReceiver\+::percent\+Received (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 108 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{109 \{}
\DoxyCodeLine{110   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classVLReceiver_a70272e1e665654e412f59dfd2dc15bc2}{isReceiving}}()) \{}
\DoxyCodeLine{111     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{112   \}}
\DoxyCodeLine{113   uint8\_t blocks = \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a4be1b1c1cb2684d2997b1c8a6f0cd34d}{data}}()[0];}
\DoxyCodeLine{114   uint8\_t remainder = \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a4be1b1c1cb2684d2997b1c8a6f0cd34d}{data}}()[1];}
\DoxyCodeLine{115   uint16\_t total = ((blocks -\/ 1) * 32) + remainder;}
\DoxyCodeLine{116   \textcolor{comment}{// round by adding half of the total to the numerator}}
\DoxyCodeLine{117   \textcolor{keywordflow}{return} (uint8\_t)((uint16\_t)((\mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a6e99106ef46e33b45c8bcd51c0384a3f}{bytepos}}() * 100 + (total / 2)) / total));}
\DoxyCodeLine{118 \}}

\end{DoxyCode}


References Bit\+Stream\+::bytepos(), Bit\+Stream\+::data(), is\+Receiving(), and m\+\_\+vl\+Data.



Referenced by Mode\+Sharing\+::show\+Receive\+Mode().

\mbox{\Hypertarget{classVLReceiver_ab46186e351091b92acdfe8bae1503f68}\label{classVLReceiver_ab46186e351091b92acdfe8bae1503f68}} 
\index{VLReceiver@{VLReceiver}!read@{read}}
\index{read@{read}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{read()}{read()}}
{\footnotesize\ttfamily bool VLReceiver\+::read (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classByteStream}{Byte\+Stream}} \&}]{data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 180 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{181 \{}
\DoxyCodeLine{182   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a6e99106ef46e33b45c8bcd51c0384a3f}{bytepos}}() || \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a6e99106ef46e33b45c8bcd51c0384a3f}{bytepos}}() > \mbox{\hyperlink{VLConfig_8h_a5531f46c73b52342bc76a5423252c745}{VL\_MAX\_DATA\_TRANSFER}}) \{}
\DoxyCodeLine{183     \mbox{\hyperlink{Log_8h_a5d2f30bd1cbcf49f829a7e8eb6173c06}{DEBUG\_LOG}}(\textcolor{stringliteral}{"{}Nothing to read, or read too much"{}});}
\DoxyCodeLine{184     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{185   \}}
\DoxyCodeLine{186   \textcolor{comment}{// read the size out (blocks + remainder)}}
\DoxyCodeLine{187   uint8\_t blocks = \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a4be1b1c1cb2684d2997b1c8a6f0cd34d}{data}}()[0];}
\DoxyCodeLine{188   uint8\_t remainder = \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a4be1b1c1cb2684d2997b1c8a6f0cd34d}{data}}()[1];}
\DoxyCodeLine{189   \textcolor{comment}{// calculate size from blocks + remainder}}
\DoxyCodeLine{190   uint32\_t size = ((blocks -\/ 1) * 32) + remainder;}
\DoxyCodeLine{191   \textcolor{keywordflow}{if} (!size || size > \mbox{\hyperlink{VLConfig_8h_a5531f46c73b52342bc76a5423252c745}{VL\_MAX\_DATA\_TRANSFER}}) \{}
\DoxyCodeLine{192     \mbox{\hyperlink{Log_8h_a8bdccae09f7cdda8fb311e0bd81c35dc}{DEBUG\_LOGF}}(\textcolor{stringliteral}{"{}Bad VL Data size: \%u"{}}, size);}
\DoxyCodeLine{193     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{194   \}}
\DoxyCodeLine{195   \textcolor{comment}{// the actual data starts 2 bytes later because of the size byte}}
\DoxyCodeLine{196   \textcolor{keyword}{const} uint8\_t *actualData = \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_a4be1b1c1cb2684d2997b1c8a6f0cd34d}{data}}() + 2;}
\DoxyCodeLine{197   \textcolor{keywordflow}{if} (!data.\mbox{\hyperlink{classByteStream_a0f89f3776726a6b70248a901c029a305}{rawInit}}(actualData, size)) \{}
\DoxyCodeLine{198     \mbox{\hyperlink{Log_8h_a5d2f30bd1cbcf49f829a7e8eb6173c06}{DEBUG\_LOG}}(\textcolor{stringliteral}{"{}Failed to init buffer for VL read"{}});}
\DoxyCodeLine{199     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{200   \}}
\DoxyCodeLine{201   \textcolor{comment}{// reset the VL state and receive buffer now}}
\DoxyCodeLine{202   \mbox{\hyperlink{classVLReceiver_a9d711ae64327b2b26c168478f92231b1}{resetVLState}}();}
\DoxyCodeLine{203   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{204 \}}

\end{DoxyCode}


References Bit\+Stream\+::bytepos(), Bit\+Stream\+::data(), DEBUG\+\_\+\+LOG, DEBUG\+\_\+\+LOGF, m\+\_\+vl\+Data, Byte\+Stream\+::raw\+Init(), reset\+VLState(), and VL\+\_\+\+MAX\+\_\+\+DATA\+\_\+\+TRANSFER.



Referenced by receive\+Mode().

\mbox{\Hypertarget{classVLReceiver_add2bca7d2ad4e1f3653f04be9a6e3d21}\label{classVLReceiver_add2bca7d2ad4e1f3653f04be9a6e3d21}} 
\index{VLReceiver@{VLReceiver}!receiveMode@{receiveMode}}
\index{receiveMode@{receiveMode}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{receiveMode()}{receiveMode()}}
{\footnotesize\ttfamily bool VLReceiver\+::receive\+Mode (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classMode}{Mode}} $\ast$}]{p\+Mode }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 120 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{121 \{}
\DoxyCodeLine{122   \mbox{\hyperlink{classByteStream}{ByteStream}} buf;}
\DoxyCodeLine{123   \textcolor{comment}{// read from the receive buffer into the byte stream}}
\DoxyCodeLine{124   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classVLReceiver_ab46186e351091b92acdfe8bae1503f68}{read}}(buf)) \{}
\DoxyCodeLine{125     \textcolor{comment}{// no data to read right now, or an error}}
\DoxyCodeLine{126     \mbox{\hyperlink{Log_8h_a5d2f30bd1cbcf49f829a7e8eb6173c06}{DEBUG\_LOG}}(\textcolor{stringliteral}{"{}No data available to read, or error reading"{}});}
\DoxyCodeLine{127     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{128   \}}
\DoxyCodeLine{129   \mbox{\hyperlink{Log_8h_a8bdccae09f7cdda8fb311e0bd81c35dc}{DEBUG\_LOGF}}(\textcolor{stringliteral}{"{}Received \%u bytes"{}}, buf.\mbox{\hyperlink{classByteStream_a755097adde5b21b33d3c4e3623d04f97}{rawSize}}());}
\DoxyCodeLine{130   \textcolor{comment}{// load the data into the target mode}}
\DoxyCodeLine{131   \textcolor{keywordflow}{return} pMode-\/>\mbox{\hyperlink{classMode_a31ed6fbb39ca7876e415fc58bc18d630}{loadFromBuffer}}(buf);}
\DoxyCodeLine{132 \}}

\end{DoxyCode}


References DEBUG\+\_\+\+LOG, DEBUG\+\_\+\+LOGF, Mode\+::load\+From\+Buffer(), Byte\+Stream\+::raw\+Size(), and read().



Referenced by Mode\+Sharing\+::receive\+Mode\+VL().

\mbox{\Hypertarget{classVLReceiver_ada08a00c52a7d4aa531c332b358b386f}\label{classVLReceiver_ada08a00c52a7d4aa531c332b358b386f}} 
\index{VLReceiver@{VLReceiver}!recvPCIHandler@{recvPCIHandler}}
\index{recvPCIHandler@{recvPCIHandler}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{recvPCIHandler()}{recvPCIHandler()}}
{\footnotesize\ttfamily void VLReceiver\+::recv\+PCIHandler (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 207 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{208 \{}
\DoxyCodeLine{209   \textcolor{comment}{// toggle the tracked pin state no matter what}}
\DoxyCodeLine{210   \mbox{\hyperlink{classVLReceiver_aa56911b2c08cbff0a1d5e2685d7506f9}{m\_pinState}} = (uint8\_t)!\mbox{\hyperlink{classVLReceiver_aa56911b2c08cbff0a1d5e2685d7506f9}{m\_pinState}};}
\DoxyCodeLine{211   \textcolor{comment}{// grab current time}}
\DoxyCodeLine{212   uint32\_t now = \mbox{\hyperlink{classTime_ac44f4e49538456714372bb1aad3dd839}{Time::microseconds}}();}
\DoxyCodeLine{213   \textcolor{comment}{// check previous time for validity}}
\DoxyCodeLine{214   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classVLReceiver_a48be4a0ea04c428f7ddd0fa9723a7c35}{m\_prevTime}} || \mbox{\hyperlink{classVLReceiver_a48be4a0ea04c428f7ddd0fa9723a7c35}{m\_prevTime}} > now) \{}
\DoxyCodeLine{215     \mbox{\hyperlink{classVLReceiver_a48be4a0ea04c428f7ddd0fa9723a7c35}{m\_prevTime}} = now;}
\DoxyCodeLine{216     \mbox{\hyperlink{Log_8h_a5d2f30bd1cbcf49f829a7e8eb6173c06}{DEBUG\_LOG}}(\textcolor{stringliteral}{"{}Bad first time diff, resetting..."{}});}
\DoxyCodeLine{217     \mbox{\hyperlink{classVLReceiver_a9d711ae64327b2b26c168478f92231b1}{resetVLState}}();}
\DoxyCodeLine{218     \textcolor{keywordflow}{return};}
\DoxyCodeLine{219   \}}
\DoxyCodeLine{220   \mbox{\hyperlink{Log_8h_a8bdccae09f7cdda8fb311e0bd81c35dc}{DEBUG\_LOGF}}(\textcolor{stringliteral}{"{}Received: \%u"{}}, \mbox{\hyperlink{classVLReceiver_aa56911b2c08cbff0a1d5e2685d7506f9}{m\_pinState}});}
\DoxyCodeLine{221   \textcolor{comment}{// calc time difference between previous change and now}}
\DoxyCodeLine{222   uint32\_t diff = (uint32\_t)(now -\/ \mbox{\hyperlink{classVLReceiver_a48be4a0ea04c428f7ddd0fa9723a7c35}{m\_prevTime}});}
\DoxyCodeLine{223   \textcolor{comment}{// and update the previous changetime for next loop}}
\DoxyCodeLine{224   \mbox{\hyperlink{classVLReceiver_a48be4a0ea04c428f7ddd0fa9723a7c35}{m\_prevTime}} = now;}
\DoxyCodeLine{225   \textcolor{comment}{// handle the bliank duration and process it}}
\DoxyCodeLine{226   \textcolor{comment}{//handleVLTiming(diff);}}
\DoxyCodeLine{227 \}}

\end{DoxyCode}


References DEBUG\+\_\+\+LOG, DEBUG\+\_\+\+LOGF, m\+\_\+pin\+State, m\+\_\+prev\+Time, Time\+::microseconds(), and reset\+VLState().



Referenced by adc\+Check\+Timer\+Callback().

\mbox{\Hypertarget{classVLReceiver_a9d711ae64327b2b26c168478f92231b1}\label{classVLReceiver_a9d711ae64327b2b26c168478f92231b1}} 
\index{VLReceiver@{VLReceiver}!resetVLState@{resetVLState}}
\index{resetVLState@{resetVLState}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{resetVLState()}{resetVLState()}}
{\footnotesize\ttfamily void VLReceiver\+::reset\+VLState (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 270 of file VLReceiver.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{271 \{}
\DoxyCodeLine{272   \mbox{\hyperlink{classVLReceiver_a21679e3a4a6e2de40c74804a46572bfd}{m\_previousBytes}} = 0;}
\DoxyCodeLine{273   \mbox{\hyperlink{classVLReceiver_acf1c828ff43b3bf218975e61ed9a4f51}{m\_recvState}} = \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a47c2b836e3c6a3cd2b63e572fcaaa434}{WAITING\_HEADER\_MARK}};}
\DoxyCodeLine{274   \textcolor{comment}{// zero out the receive buffer and reset bit receiver position}}
\DoxyCodeLine{275   \mbox{\hyperlink{classVLReceiver_aea204cc185c040057fbcd408d47a3121}{m\_vlData}}.\mbox{\hyperlink{classBitStream_acbce456dc347c721637941fe47f5a43b}{reset}}();}
\DoxyCodeLine{276   \mbox{\hyperlink{Log_8h_a5d2f30bd1cbcf49f829a7e8eb6173c06}{DEBUG\_LOG}}(\textcolor{stringliteral}{"{}VL State Reset"{}});}
\DoxyCodeLine{277 \}}

\end{DoxyCode}


References DEBUG\+\_\+\+LOG, m\+\_\+previous\+Bytes, m\+\_\+recv\+State, m\+\_\+vl\+Data, Bit\+Stream\+::reset(), and WAITING\+\_\+\+HEADER\+\_\+\+MARK.



Referenced by begin\+Receiving(), end\+Receiving(), handle\+VLTiming(), read(), Mode\+Sharing\+::receive\+Mode\+VL(), and recv\+PCIHandler().



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classVLReceiver_aa56911b2c08cbff0a1d5e2685d7506f9}\label{classVLReceiver_aa56911b2c08cbff0a1d5e2685d7506f9}} 
\index{VLReceiver@{VLReceiver}!m\_pinState@{m\_pinState}}
\index{m\_pinState@{m\_pinState}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{m\_pinState}{m\_pinState}}
{\footnotesize\ttfamily uint8\+\_\+t VLReceiver\+::m\+\_\+pin\+State = 0\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 75 of file VLReceiver.\+h.



Referenced by recv\+PCIHandler().

\mbox{\Hypertarget{classVLReceiver_a21679e3a4a6e2de40c74804a46572bfd}\label{classVLReceiver_a21679e3a4a6e2de40c74804a46572bfd}} 
\index{VLReceiver@{VLReceiver}!m\_previousBytes@{m\_previousBytes}}
\index{m\_previousBytes@{m\_previousBytes}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{m\_previousBytes}{m\_previousBytes}}
{\footnotesize\ttfamily uint32\+\_\+t VLReceiver\+::m\+\_\+previous\+Bytes = 0\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 78 of file VLReceiver.\+h.



Referenced by on\+New\+Data(), and reset\+VLState().

\mbox{\Hypertarget{classVLReceiver_a48be4a0ea04c428f7ddd0fa9723a7c35}\label{classVLReceiver_a48be4a0ea04c428f7ddd0fa9723a7c35}} 
\index{VLReceiver@{VLReceiver}!m\_prevTime@{m\_prevTime}}
\index{m\_prevTime@{m\_prevTime}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{m\_prevTime}{m\_prevTime}}
{\footnotesize\ttfamily uint32\+\_\+t VLReceiver\+::m\+\_\+prev\+Time = 0\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 74 of file VLReceiver.\+h.



Referenced by recv\+PCIHandler().

\mbox{\Hypertarget{classVLReceiver_acf1c828ff43b3bf218975e61ed9a4f51}\label{classVLReceiver_acf1c828ff43b3bf218975e61ed9a4f51}} 
\index{VLReceiver@{VLReceiver}!m\_recvState@{m\_recvState}}
\index{m\_recvState@{m\_recvState}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{m\_recvState}{m\_recvState}}
{\footnotesize\ttfamily \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8}{VLReceiver\+::\+Recv\+State}} VLReceiver\+::m\+\_\+recv\+State = \mbox{\hyperlink{classVLReceiver_aa4e2da364b508e8f469d28e0eaf3a6f8a47c2b836e3c6a3cd2b63e572fcaaa434}{WAITING\+\_\+\+HEADER\+\_\+\+MARK}}\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 72 of file VLReceiver.\+h.



Referenced by handle\+VLTiming(), and reset\+VLState().

\mbox{\Hypertarget{classVLReceiver_aea204cc185c040057fbcd408d47a3121}\label{classVLReceiver_aea204cc185c040057fbcd408d47a3121}} 
\index{VLReceiver@{VLReceiver}!m\_vlData@{m\_vlData}}
\index{m\_vlData@{m\_vlData}!VLReceiver@{VLReceiver}}
\doxysubsubsection{\texorpdfstring{m\_vlData}{m\_vlData}}
{\footnotesize\ttfamily \mbox{\hyperlink{classBitStream}{Bit\+Stream}} VLReceiver\+::m\+\_\+vl\+Data\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 60 of file VLReceiver.\+h.



Referenced by bytes\+Received(), data\+Ready(), handle\+VLTiming(), init(), is\+Receiving(), percent\+Received(), read(), and reset\+VLState().



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
Vortex\+Engine/src/\+Wireless/\mbox{\hyperlink{VLReceiver_8h}{VLReceiver.\+h}}\item 
Vortex\+Engine/src/\+Wireless/\mbox{\hyperlink{VLReceiver_8cpp}{VLReceiver.\+cpp}}\end{DoxyCompactItemize}
