\hypertarget{classStorage}{}\doxysection{Storage Class Reference}
\label{classStorage}\index{Storage@{Storage}}


{\ttfamily \#include $<$Storage.\+h$>$}

\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static bool \mbox{\hyperlink{classStorage_a065812a8dbd82d731291b5aa7ce3edf9}{init}} ()
\item 
static void \mbox{\hyperlink{classStorage_a2a1ce108c9a17f6175bfb9a9aba51703}{cleanup}} ()
\item 
static bool \mbox{\hyperlink{classStorage_a97a1b036dedd7b94a91899638c2248c1}{write}} (uint16\+\_\+t slot, \mbox{\hyperlink{classByteStream}{Byte\+Stream}} \&buffer)
\item 
static bool \mbox{\hyperlink{classStorage_a463f451de890486dd483575e47defbc7}{read}} (uint16\+\_\+t slot, \mbox{\hyperlink{classByteStream}{Byte\+Stream}} \&buffer)
\item 
static uint32\+\_\+t \mbox{\hyperlink{classStorage_a79176e030af1f92f563c2b19316fe3dd}{last\+Save\+Size}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classStorage_a80ef6af5e4c9fd4424ae16e808d05291}{Storage}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Static Private Attributes}
\begin{DoxyCompactItemize}
\item 
static uint32\+\_\+t \mbox{\hyperlink{classStorage_ae85ca521ae89c408fb045d2890951458}{m\+\_\+last\+Save\+Size}} = 0
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 12 of file Storage.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classStorage_a80ef6af5e4c9fd4424ae16e808d05291}\label{classStorage_a80ef6af5e4c9fd4424ae16e808d05291}} 
\index{Storage@{Storage}!Storage@{Storage}}
\index{Storage@{Storage}!Storage@{Storage}}
\doxysubsubsection{\texorpdfstring{Storage()}{Storage()}}
{\footnotesize\ttfamily Storage\+::\+Storage (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 41 of file Storage.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{42 \{}
\DoxyCodeLine{43 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classStorage_a2a1ce108c9a17f6175bfb9a9aba51703}\label{classStorage_a2a1ce108c9a17f6175bfb9a9aba51703}} 
\index{Storage@{Storage}!cleanup@{cleanup}}
\index{cleanup@{cleanup}!Storage@{Storage}}
\doxysubsubsection{\texorpdfstring{cleanup()}{cleanup()}}
{\footnotesize\ttfamily void Storage\+::cleanup (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 55 of file Storage.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{56 \{}
\DoxyCodeLine{57 \}}

\end{DoxyCode}


Referenced by Vortex\+Engine\+::cleanup().

\mbox{\Hypertarget{classStorage_a065812a8dbd82d731291b5aa7ce3edf9}\label{classStorage_a065812a8dbd82d731291b5aa7ce3edf9}} 
\index{Storage@{Storage}!init@{init}}
\index{init@{init}!Storage@{Storage}}
\doxysubsubsection{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily bool Storage\+::init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 45 of file Storage.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{46 \{}
\DoxyCodeLine{47 \textcolor{preprocessor}{\#ifdef VORTEX\_LIB}}
\DoxyCodeLine{48   \textcolor{keywordflow}{if} (!m\_storageFilename.length() \&\& \mbox{\hyperlink{classVortex_aa287fb05ef87acfb1380aeac868d17a1}{Vortex::storageEnabled}}()) \{}
\DoxyCodeLine{49     m\_storageFilename = \mbox{\hyperlink{Storage_8cpp_a3afbe062209d42a72bc5b4a03a86206a}{DEFAULT\_STORAGE\_FILENAME}};}
\DoxyCodeLine{50   \}}
\DoxyCodeLine{51 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{52   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{53 \}}

\end{DoxyCode}


References DEFAULT\+\_\+\+STORAGE\+\_\+\+FILENAME, and Vortex\+::storage\+Enabled().



Referenced by Vortex\+Engine\+::init().

\mbox{\Hypertarget{classStorage_a79176e030af1f92f563c2b19316fe3dd}\label{classStorage_a79176e030af1f92f563c2b19316fe3dd}} 
\index{Storage@{Storage}!lastSaveSize@{lastSaveSize}}
\index{lastSaveSize@{lastSaveSize}!Storage@{Storage}}
\doxysubsubsection{\texorpdfstring{lastSaveSize()}{lastSaveSize()}}
{\footnotesize\ttfamily uint32\+\_\+t Storage\+::last\+Save\+Size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 216 of file Storage.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{217 \{}
\DoxyCodeLine{218   \textcolor{keywordflow}{return} \mbox{\hyperlink{classStorage_ae85ca521ae89c408fb045d2890951458}{m\_lastSaveSize}};}
\DoxyCodeLine{219 \}}

\end{DoxyCode}


References m\+\_\+last\+Save\+Size.

\mbox{\Hypertarget{classStorage_a463f451de890486dd483575e47defbc7}\label{classStorage_a463f451de890486dd483575e47defbc7}} 
\index{Storage@{Storage}!read@{read}}
\index{read@{read}!Storage@{Storage}}
\doxysubsubsection{\texorpdfstring{read()}{read()}}
{\footnotesize\ttfamily bool Storage\+::read (\begin{DoxyParamCaption}\item[{uint16\+\_\+t}]{slot,  }\item[{\mbox{\hyperlink{classByteStream}{Byte\+Stream}} \&}]{buffer }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 156 of file Storage.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{157 \{}
\DoxyCodeLine{158 \textcolor{preprocessor}{\#ifdef VORTEX\_LIB}}
\DoxyCodeLine{159   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classVortex_aa287fb05ef87acfb1380aeac868d17a1}{Vortex::storageEnabled}}()) \{}
\DoxyCodeLine{160     \textcolor{comment}{// return false here, but true in write because we don't want to return}}
\DoxyCodeLine{161     \textcolor{comment}{// an empty buffer after returning true}}
\DoxyCodeLine{162     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{163   \}}
\DoxyCodeLine{164 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{165   uint32\_t size = \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}};}
\DoxyCodeLine{166   \textcolor{keywordflow}{if} (size > \mbox{\hyperlink{VortexConfig_8h_a8d6f782ffe53d87f0fd0327d4b09352c}{STORAGE\_SIZE}} || size < \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structByteStream_1_1RawBuffer}{ByteStream::RawBuffer}}) + 4 || slot >= \mbox{\hyperlink{VortexConfig_8h_ab0c5cc9223512ec01c405592b6741898}{NUM\_MODE\_SLOTS}}) \{}
\DoxyCodeLine{167     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{168   \}}
\DoxyCodeLine{169   \textcolor{keywordflow}{if} (!buffer.\mbox{\hyperlink{classByteStream_a0ad269c0275cb8856c44a9ea92c59a1a}{init}}(size)) \{}
\DoxyCodeLine{170     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{171   \}}
\DoxyCodeLine{172 \textcolor{preprocessor}{\#ifdef VORTEX\_EMBEDDED}}
\DoxyCodeLine{173   \textcolor{comment}{// read directly into the raw data of the byte array}}
\DoxyCodeLine{174   memcpy(buffer.\mbox{\hyperlink{classByteStream_a6993f9575592309a501156db31f82554}{rawData}}(), (\textcolor{keyword}{const} \textcolor{keywordtype}{void} *)(\_storagedata + (slot * \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}})), size);}
\DoxyCodeLine{175 \textcolor{preprocessor}{\#elif defined(\_WIN32)}}
\DoxyCodeLine{176   HANDLE hFile = CreateFile(\mbox{\hyperlink{Storage_8cpp_a4a8bec941d32acc2e0c33423a61e661f}{STORAGE\_FILENAME}}, GENERIC\_READ, 0, NULL, OPEN\_EXISTING, FILE\_ATTRIBUTE\_NORMAL, NULL);}
\DoxyCodeLine{177   \textcolor{keywordflow}{if} (hFile == INVALID\_HANDLE\_VALUE) \{}
\DoxyCodeLine{178     \textcolor{comment}{// error}}
\DoxyCodeLine{179     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{180   \}}
\DoxyCodeLine{181   DWORD bytesRead = 0;}
\DoxyCodeLine{182   DWORD offset = slot * \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}};}
\DoxyCodeLine{183   SetFilePointer(hFile, offset, NULL, FILE\_BEGIN);}
\DoxyCodeLine{184   \textcolor{keywordflow}{if} (!ReadFile(hFile, buffer.\mbox{\hyperlink{classByteStream_a6993f9575592309a501156db31f82554}{rawData}}(), \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}}, \&bytesRead, NULL)) \{}
\DoxyCodeLine{185     \textcolor{comment}{// error}}
\DoxyCodeLine{186     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{187   \}}
\DoxyCodeLine{188   CloseHandle(hFile);}
\DoxyCodeLine{189 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{190   FILE *f = fopen(\mbox{\hyperlink{Storage_8cpp_a4a8bec941d32acc2e0c33423a61e661f}{STORAGE\_FILENAME}}, \textcolor{stringliteral}{"{}r"{}});}
\DoxyCodeLine{191   \textcolor{keywordflow}{if} (!f) \{}
\DoxyCodeLine{192     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{193   \}}
\DoxyCodeLine{194   \textcolor{keywordtype}{long} offset = slot * \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}};}
\DoxyCodeLine{195   fseek(f, offset, SEEK\_SET);}
\DoxyCodeLine{196   \textcolor{keywordflow}{if} (!fread(buffer.\mbox{\hyperlink{classByteStream_a6993f9575592309a501156db31f82554}{rawData}}(), \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}), \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}}, f)) \{}
\DoxyCodeLine{197     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{198   \}}
\DoxyCodeLine{199   fclose(f);}
\DoxyCodeLine{200 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{201   \textcolor{comment}{// ensure the internal buffer is sane after reading it out, this}}
\DoxyCodeLine{202   \textcolor{comment}{// prevents segfaults if the internal size reports larger than capacity}}
\DoxyCodeLine{203   buffer.\mbox{\hyperlink{classByteStream_ae65462bc14d268fcf0ffccf65f878762}{sanity}}();}
\DoxyCodeLine{204   \textcolor{comment}{// check crc immediately since we read into raw data copying the}}
\DoxyCodeLine{205   \textcolor{comment}{// array could be dangerous}}
\DoxyCodeLine{206   \textcolor{keywordflow}{if} (!buffer.\mbox{\hyperlink{classByteStream_ae3412b7f08252fa2baab4b11cb8c2484}{checkCRC}}()) \{}
\DoxyCodeLine{207     buffer.\mbox{\hyperlink{classByteStream_a854e5507f550826478fd7141074a4bb5}{clear}}();}
\DoxyCodeLine{208     \mbox{\hyperlink{Log_8h_aa12d9b2ced7332bfbb9391da9617561a}{ERROR\_LOG}}(\textcolor{stringliteral}{"{}Could not verify buffer"{}});}
\DoxyCodeLine{209     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{210   \}}
\DoxyCodeLine{211   \mbox{\hyperlink{classStorage_ae85ca521ae89c408fb045d2890951458}{m\_lastSaveSize}} = size;}
\DoxyCodeLine{212   \mbox{\hyperlink{Log_8h_a8bdccae09f7cdda8fb311e0bd81c35dc}{DEBUG\_LOGF}}(\textcolor{stringliteral}{"{}Loaded savedata (Size: \%u)"{}}, buffer.\mbox{\hyperlink{classByteStream_adf87e444e828287c0a43cab2958ca01b}{size}}());}
\DoxyCodeLine{213   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{214 \}}

\end{DoxyCode}


References Byte\+Stream\+::check\+CRC(), Byte\+Stream\+::clear(), DEBUG\+\_\+\+LOGF, ERROR\+\_\+\+LOG, Byte\+Stream\+::init(), m\+\_\+last\+Save\+Size, MAX\+\_\+\+MODE\+\_\+\+SIZE, NUM\+\_\+\+MODE\+\_\+\+SLOTS, Byte\+Stream\+::raw\+Data(), Byte\+Stream\+::sanity(), Byte\+Stream\+::size(), STORAGE\+\_\+\+FILENAME, STORAGE\+\_\+\+SIZE, and Vortex\+::storage\+Enabled().



Referenced by Modes\+::init(), Modes\+::load\+Header(), and Modes\+::load\+Storage().

\mbox{\Hypertarget{classStorage_a97a1b036dedd7b94a91899638c2248c1}\label{classStorage_a97a1b036dedd7b94a91899638c2248c1}} 
\index{Storage@{Storage}!write@{write}}
\index{write@{write}!Storage@{Storage}}
\doxysubsubsection{\texorpdfstring{write()}{write()}}
{\footnotesize\ttfamily bool Storage\+::write (\begin{DoxyParamCaption}\item[{uint16\+\_\+t}]{slot,  }\item[{\mbox{\hyperlink{classByteStream}{Byte\+Stream}} \&}]{buffer }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 60 of file Storage.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{61 \{}
\DoxyCodeLine{62 \textcolor{preprocessor}{\#ifdef VORTEX\_LIB}}
\DoxyCodeLine{63   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classVortex_aa287fb05ef87acfb1380aeac868d17a1}{Vortex::storageEnabled}}()) \{}
\DoxyCodeLine{64     \textcolor{comment}{// success so the system thinks it all worked}}
\DoxyCodeLine{65     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{66   \}}
\DoxyCodeLine{67 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{68   \textcolor{comment}{// check size}}
\DoxyCodeLine{69   \textcolor{keywordflow}{if} (buffer.\mbox{\hyperlink{classByteStream_a755097adde5b21b33d3c4e3623d04f97}{rawSize}}() > \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}}) \{}
\DoxyCodeLine{70     \mbox{\hyperlink{Log_8h_aa12d9b2ced7332bfbb9391da9617561a}{ERROR\_LOG}}(\textcolor{stringliteral}{"{}Buffer too big for storage space"{}});}
\DoxyCodeLine{71     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{72   \}}
\DoxyCodeLine{73   \textcolor{keywordflow}{if} (slot >= \mbox{\hyperlink{VortexConfig_8h_ab0c5cc9223512ec01c405592b6741898}{NUM\_MODE\_SLOTS}}) \{}
\DoxyCodeLine{74     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{75   \}}
\DoxyCodeLine{76   \textcolor{comment}{// just in case}}
\DoxyCodeLine{77   buffer.\mbox{\hyperlink{classByteStream_a282f071ea249471c360d364642f9b3c7}{recalcCRC}}();}
\DoxyCodeLine{78 \textcolor{preprocessor}{\#ifdef VORTEX\_EMBEDDED}}
\DoxyCodeLine{79   \textcolor{comment}{// the target slot to store in}}
\DoxyCodeLine{80   uint32\_t storage\_slot = (uint32\_t)\_storagedata + (slot * \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}});}
\DoxyCodeLine{81 }
\DoxyCodeLine{82   \textcolor{comment}{// Number of rows to erase for one slot}}
\DoxyCodeLine{83   uint16\_t rows\_to\_erase = \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}} / (\mbox{\hyperlink{Storage_8cpp_a7d467c1d283fdfa1f2081ba1e0d01b6e}{PAGE\_SIZE}} * 4);}
\DoxyCodeLine{84   \textcolor{comment}{// Erase only the rows containing the slot}}
\DoxyCodeLine{85   \textcolor{keywordflow}{for} (uint16\_t i = 0; i < rows\_to\_erase; ++i) \{}
\DoxyCodeLine{86     \textcolor{comment}{// Set the address for the row to erase}}
\DoxyCodeLine{87     NVMCTRL-\/>ADDR.reg = (uint32\_t)(storage\_slot + (i * \mbox{\hyperlink{Storage_8cpp_a7d467c1d283fdfa1f2081ba1e0d01b6e}{PAGE\_SIZE}} * 4)) / 2;}
\DoxyCodeLine{88     \textcolor{comment}{// Execute the erase command}}
\DoxyCodeLine{89     NVMCTRL-\/>CTRLA.reg = NVMCTRL\_CTRLA\_CMDEX\_KEY | NVMCTRL\_CTRLA\_CMD\_ER;}
\DoxyCodeLine{90     \textcolor{comment}{// Wait for the erase operation to complete}}
\DoxyCodeLine{91     \textcolor{keywordflow}{while} (!NVMCTRL-\/>INTFLAG.bit.READY) \{\}}
\DoxyCodeLine{92   \}}
\DoxyCodeLine{93 }
\DoxyCodeLine{94   \textcolor{comment}{// set the last save size}}
\DoxyCodeLine{95   \mbox{\hyperlink{classStorage_ae85ca521ae89c408fb045d2890951458}{m\_lastSaveSize}} = buffer.\mbox{\hyperlink{classByteStream_adf87e444e828287c0a43cab2958ca01b}{size}}();}
\DoxyCodeLine{96 }
\DoxyCodeLine{97   \textcolor{comment}{// write out the buffer to storage}}
\DoxyCodeLine{98   \textcolor{comment}{// Calculate data boundaries}}
\DoxyCodeLine{99   uint32\_t size = (buffer.\mbox{\hyperlink{classByteStream_a755097adde5b21b33d3c4e3623d04f97}{rawSize}}() + 3) / 4;}
\DoxyCodeLine{100   \textcolor{keyword}{volatile} uint32\_t *dst\_addr = (\textcolor{keyword}{volatile} uint32\_t *)storage\_slot;}
\DoxyCodeLine{101   \textcolor{keyword}{const} uint8\_t *src\_addr = (uint8\_t *)buffer.\mbox{\hyperlink{classByteStream_a6993f9575592309a501156db31f82554}{rawData}}();}
\DoxyCodeLine{102 }
\DoxyCodeLine{103   \textcolor{comment}{// Disable automatic page write}}
\DoxyCodeLine{104   NVMCTRL-\/>CTRLB.bit.MANW = 1;}
\DoxyCodeLine{105 }
\DoxyCodeLine{106   \textcolor{comment}{// Do writes in pages}}
\DoxyCodeLine{107   \textcolor{keywordflow}{while} (size) \{}
\DoxyCodeLine{108     \textcolor{comment}{// Execute "{}PBC"{} Page Buffer Clear}}
\DoxyCodeLine{109     NVMCTRL-\/>CTRLA.reg = NVMCTRL\_CTRLA\_CMDEX\_KEY | NVMCTRL\_CTRLA\_CMD\_PBC;}
\DoxyCodeLine{110     \textcolor{keywordflow}{while} (NVMCTRL-\/>INTFLAG.bit.READY == 0) \{\}}
\DoxyCodeLine{111 }
\DoxyCodeLine{112     \textcolor{comment}{// Fill page buffer}}
\DoxyCodeLine{113     uint32\_t i;}
\DoxyCodeLine{114     \textcolor{keywordflow}{for} (i = 0; i < (\mbox{\hyperlink{Storage_8cpp_a7d467c1d283fdfa1f2081ba1e0d01b6e}{PAGE\_SIZE}} / 4) \&\& size; i++) \{}
\DoxyCodeLine{115       *dst\_addr = *(uint32\_t *)(src\_addr);}
\DoxyCodeLine{116       src\_addr += \textcolor{keyword}{sizeof}(uint32\_t);}
\DoxyCodeLine{117       dst\_addr++;}
\DoxyCodeLine{118       size-\/-\/;}
\DoxyCodeLine{119     \}}
\DoxyCodeLine{120 }
\DoxyCodeLine{121     \textcolor{comment}{// Execute "{}WP"{} Write Page}}
\DoxyCodeLine{122     NVMCTRL-\/>CTRLA.reg = NVMCTRL\_CTRLA\_CMDEX\_KEY | NVMCTRL\_CTRLA\_CMD\_WP;}
\DoxyCodeLine{123     \textcolor{keywordflow}{while} (NVMCTRL-\/>INTFLAG.bit.READY == 0) \{\}}
\DoxyCodeLine{124   \}}
\DoxyCodeLine{125 \textcolor{preprocessor}{\#elif defined(\_WIN32)}}
\DoxyCodeLine{126   HANDLE hFile = CreateFile(\mbox{\hyperlink{Storage_8cpp_a4a8bec941d32acc2e0c33423a61e661f}{STORAGE\_FILENAME}}, GENERIC\_READ | GENERIC\_WRITE, 0, NULL, OPEN\_ALWAYS, FILE\_ATTRIBUTE\_NORMAL, NULL);}
\DoxyCodeLine{127   \textcolor{keywordflow}{if} (hFile == INVALID\_HANDLE\_VALUE) \{}
\DoxyCodeLine{128     \textcolor{comment}{// error}}
\DoxyCodeLine{129     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{130   \}}
\DoxyCodeLine{131   DWORD written = 0;}
\DoxyCodeLine{132   DWORD offset = slot * \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}};}
\DoxyCodeLine{133   SetFilePointer(hFile, offset, NULL, FILE\_BEGIN);}
\DoxyCodeLine{134   \textcolor{keywordflow}{if} (!WriteFile(hFile, buffer.\mbox{\hyperlink{classByteStream_a6993f9575592309a501156db31f82554}{rawData}}(), \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}}, \&written, NULL)) \{}
\DoxyCodeLine{135     \textcolor{comment}{// error}}
\DoxyCodeLine{136     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{137   \}}
\DoxyCodeLine{138   CloseHandle(hFile);}
\DoxyCodeLine{139 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{140   FILE *f = fopen(\mbox{\hyperlink{Storage_8cpp_a4a8bec941d32acc2e0c33423a61e661f}{STORAGE\_FILENAME}}, \textcolor{stringliteral}{"{}w"{}});}
\DoxyCodeLine{141   \textcolor{keywordflow}{if} (!f) \{}
\DoxyCodeLine{142     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{143   \}}
\DoxyCodeLine{144   \textcolor{keywordtype}{long} offset = slot * \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}};}
\DoxyCodeLine{145   fseek(f, offset, SEEK\_SET);}
\DoxyCodeLine{146   \textcolor{keywordflow}{if} (!fwrite(buffer.\mbox{\hyperlink{classByteStream_a6993f9575592309a501156db31f82554}{rawData}}(), \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}), \mbox{\hyperlink{VortexConfig_8h_a4d5f0e0392f00d31715ddf81eb87434a}{MAX\_MODE\_SIZE}}, f)) \{}
\DoxyCodeLine{147     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{148   \}}
\DoxyCodeLine{149   fclose(f);}
\DoxyCodeLine{150 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// VORTEX\_EMBEDDED}}
\DoxyCodeLine{151   \mbox{\hyperlink{Log_8h_a8bdccae09f7cdda8fb311e0bd81c35dc}{DEBUG\_LOGF}}(\textcolor{stringliteral}{"{}Wrote \%u bytes to storage (max: \%u)"{}}, \mbox{\hyperlink{classStorage_ae85ca521ae89c408fb045d2890951458}{m\_lastSaveSize}}, \mbox{\hyperlink{VortexConfig_8h_a8d6f782ffe53d87f0fd0327d4b09352c}{STORAGE\_SIZE}});}
\DoxyCodeLine{152   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{153 \}}

\end{DoxyCode}


References DEBUG\+\_\+\+LOGF, ERROR\+\_\+\+LOG, m\+\_\+last\+Save\+Size, MAX\+\_\+\+MODE\+\_\+\+SIZE, NUM\+\_\+\+MODE\+\_\+\+SLOTS, PAGE\+\_\+\+SIZE, Byte\+Stream\+::raw\+Data(), Byte\+Stream\+::raw\+Size(), Byte\+Stream\+::recalc\+CRC(), Byte\+Stream\+::size(), STORAGE\+\_\+\+FILENAME, STORAGE\+\_\+\+SIZE, and Vortex\+::storage\+Enabled().



Referenced by Modes\+::save\+Header(), and Modes\+::save\+Storage().



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classStorage_ae85ca521ae89c408fb045d2890951458}\label{classStorage_ae85ca521ae89c408fb045d2890951458}} 
\index{Storage@{Storage}!m\_lastSaveSize@{m\_lastSaveSize}}
\index{m\_lastSaveSize@{m\_lastSaveSize}!Storage@{Storage}}
\doxysubsubsection{\texorpdfstring{m\_lastSaveSize}{m\_lastSaveSize}}
{\footnotesize\ttfamily uint32\+\_\+t Storage\+::m\+\_\+last\+Save\+Size = 0\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 40 of file Storage.\+h.



Referenced by last\+Save\+Size(), read(), and write().



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
Vortex\+Engine/src/\+Storage/\mbox{\hyperlink{Storage_8h}{Storage.\+h}}\item 
Vortex\+Engine/src/\+Storage/\mbox{\hyperlink{Storage_8cpp}{Storage.\+cpp}}\end{DoxyCompactItemize}
